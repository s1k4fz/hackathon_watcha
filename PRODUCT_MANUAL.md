# ⚔️ 残响：叙语连接 (Project Soul Link) - 产品白皮书

> **Version**: 1.1.0 (Final Demo Release)  
> **Date**: 2026-01-18  
> **Status**: Feature Complete  
> **Team**: AI Native Dev Team (Human & Cursor)

---

## 1. 产品愿景 (Product Vision)

**“拒绝冷冰冰的指令列表，让战斗回归角色扮演的本质。”**

传统的二次元 RPG 游戏（如《崩坏：星穹铁道》、《FGO》）虽然画面精美，但玩家与角色的互动往往止步于点击固定的技能图标。**残响：叙语连接** 旨在打破这一藩篱，利用生成式 AI (GenAI) 构建一个**自然语言驱动、即时语音反馈、高度个性化且数值严谨**的沉浸式战斗体验。

我们的核心理念是：**指令即对话，人设即玩法，数值即叙事。**

---

## 2. 核心亮点 (Key Highlights)

### 🗣️ 2.1 意图驱动与全语音反馈 (Intent-Driven & Full Voice Feedback)
- **自然语言指挥**：玩家无需记忆复杂的技能名称，只需像指挥官一样下达模糊指令（如：“绫雀，帮我拖住敌人！”或“赫尔加，别管防守了，全力输出！”）。
- **AI 战术解析**：后台 LLM 实时充当“战术副官”，解析玩家意图，结合战场局势（HP、敌方状态）自动决策最优技能。
- **情绪化 TTS 引擎**：集成了 **Fish Audio** 模型，实现了毫秒级的流式语音合成。系统能自动剥离 AI 生成的情绪标签（如 `(angry)`, `(sad)`），只朗读台词，让语音充满情感起伏，而非机械捧读。

### 🎨 2.2 无缝融入叙事的角色生成 (Narrative-Integrated Character Gen)
- **对话即捏人**：摒弃了传统的“填表式”创建角色。在游戏开场的“苏醒”剧情中，玩家通过与看板娘（绫雀）的自然对话介绍自己，AI 在后台静默分析玩家的性格、战斗偏好。
- **原子化技能组装**：系统将技能拆解为原子效果（Damage, Heal, Defense, Self-Damage, Buff），AI 根据玩家描述动态组装出独一无二的技能组和数值体系。
- **即时投入战斗**：生成的角色卡片确认后，直接无缝加入队伍，拥有专属立绘、属性面板和技能逻辑，实现“我”在故事中的真实在场感。

### ⏱️ 2.3 深度战斗系统：速度与行动值 (Speed & Action Value)
- **行动值 (AV) 算法**：引入了经典的 **Action Value (AV)** 机制（AV = 10000 / Speed）。速度不再只是一个简单的属性，而是决定行动频率的核心变量。速度越快，AV 越小，行动越频繁。
- **可视化行动轴**：战斗界面左侧实时计算并预演未来 5 个回合的行动序列（Action Queue）。系统会根据当前的 AV 值动态排序，玩家可以直观地看到谁先动手。
- **策略博弈**：玩家需要根据行动条制定策略。例如，利用高速角色的“插队”能力抢先击杀残血敌人，或者在敌人行动前通过多次行动叠加 Buff。告别了传统的“你一拳我一脚”，实现了真正的动态回合制。

### 🔗 2.4 阵营与羁绊系统 (Faction & Bond System)
- **动态羁绊触发**：战斗系统实时检测队伍构成。当特定角色组合（如“洛书”与“绫雀”）或同阵营角色（如“晓光机关”≥2人）同时在场时，自动激活强力羁绊。
- **多样化效果**：
    - **晓光协议**：增加全队防御。
    - **重火倾泻**：增加全队暴击。
    - **残响双子**（特殊）：特定角色组合触发攻击力巨幅提升。
    - **猫鼠游戏**（特殊）：赫尔加与吱吱同时在场，分别获得爆伤和减伤加成。

### 😈 2.5 沉浸式敌对 AI (Immersive Enemy AI)
- **拒绝哑巴怪**：敌人不再是沉默的数据块。它们拥有自己的人设（如“堕落的圣骑士”、“虚空潜行者”）。
- **技能台词喊话**：敌人在释放特定技能（如“深渊突刺”、“视界毁灭”）时，会配合 TTS 语音喊出霸气的招式台词，极大地增强了战斗的压迫感和临场感。
- **战术随机性**：敌人 AI 也会根据自身性格在多种技能中进行权衡。

### 📊 2.6 硬核的战斗数值内核 (Solid Combat Mechanics)
- **硬核伤害公式**：尽管前端表现形式是 AI 驱动的，但底层战斗逻辑严谨可靠。实现了包含 **基础伤害区 × 增伤区 × 防御减免区 × 暴击区** 的完整伤害计算公式，并引入了 0.95~1.05 的随机浮动值，保证了游戏性的深度。
- **可视化调试**：战斗日志实时展示详细的伤害计算过程（如：`攻160×倍率1.2 | 防100->免33% | 暴15%×1.5`），兼顾了娱乐性与硬核玩家的数据分析需求。

---

## 3. 完整用户体验流程 (User Journey)

我们构建了一个完整的、电影化的 Demo 流程，包含以下 10 个阶段：

1.  **START**: 动态视频封面，点击任意位置启动。
2.  **INTRO_CG**: 黑底白字的开场独白，交代“静默灾厄”后的世界观。
3.  **MEETING_DIALOGUE**:
    *   玩家苏醒，与绫雀对话。
    *   **核心交互**：在对话中通过自然语言描述自己，触发后台角色生成。
4.  **SELECTION_TUTORIAL**: 教学关卡选人界面，只能选择刚生成的“我”和绫雀。
5.  **BATTLE_TUTORIAL**:
    *   对手：**暗影骑士** (Shadow Knight)。
    *   体验：熟悉指令输入、观察 TTS 反馈、理解行动轴。
6.  **INTERLUDE_DIALOGUE**:
    *   战后休整，绫雀认可玩家能力。
    *   突然遭遇高能反应（Boss 预警），触发 `[READY_FOR_BATTLE]` 状态。
7.  **SELECTION_BOSS**:
    *   Boss 关卡选人，解锁更多强力队友（赫尔加、洛书、西蒙等）。
    *   右侧展示 Boss **深渊君主** 的详细情报。
8.  **BATTLE_BOSS**:
    *   对手：**深渊君主** (Abyssal Monarch) - 高血量、高伤害、带范围 AOE。
    *   体验：利用属性克制、羁绊加成和策略指挥击败强敌。
9.  **OUTRO_DIALOGUE**:
    *   击败 Boss 后的温馨对话，建立情感连接。
    *   埋下伏笔：“寻找其他残响体”。
10. **OUTRO_CG**: 结束字幕，感谢游玩。

---

## 4. 技术架构 (Technical Architecture)

### 前端核心
- **Framework**: React 18 + Vite + TypeScript
- **Styling**: Tailwind CSS v4 (最新版插件集成) + Framer Motion (动画与转场)
- **UI Design**: "Clean Slate" 风格 - 半透明毛玻璃、扁平化卡片、沉浸式大立绘。

### AI 与后端服务
- **Brain (Logic)**: OpenRouter API (兼容 OpenAI SDK)
    - 负责：意图识别、角色扮演对话、战斗数值生成、JSON 结构化输出。
- **Mouth (Voice)**: Fish Audio API
    - 负责：高质量、多角色的流式 TTS。
    - 优化：实现了**请求队列 (Request Queue)**、**节流 (Throttling)** 和 **429 自动重试** 机制，确保语音播放流畅不卡顿。

### 游戏系统设计
- **State Machine**: 使用 `GameStage` 枚举管理 10 个游戏阶段的流转。
- **Asset Loader**: 基于 `import.meta.glob` 的自动化资源加载器，只需拖入图片/音频文件即可自动映射 ID。
- **Bond System**: 动态扫描 `party` 数组，实时计算激活的 `ActiveBond`。
- **Combat Loop**: 基于时间轴的异步战斗循环，严格分离 `Player Input` -> `AI Processing` -> `Action Execution` -> `Enemy Turn`。

---

## 5. 开发里程碑 (Development Milestones)

| 阶段 | 成果 | 状态 |
| :--- | :--- | :--- |
| **Phase 1** | 基础 LLM 对接、自然语言指令解析、简单回合制战斗 | ✅ 完成 |
| **Phase 2** | Fish Audio TTS 集成、流式语音播放 | ✅ 完成 |
| **Phase 3** | 角色生成系统 (User Gen)、技能原子化重构 | ✅ 完成 |
| **Phase 4** | 速度/行动值 (AV) 系统、可视化行动条、多角色小队 | ✅ 完成 |
| **Phase 5** | 羁绊系统、阵营系统、数值平衡调整 | ✅ 完成 |
| **Phase 6** | 完整叙事流 (Intro->Boss->Outro)、Galgame 风格 UI | ✅ 完成 |
| **Phase 7** | 敌人 TTS 语音、性能优化、防死循环保护 | ✅ 完成 |

---

## 6. 未来展望 (Roadmap)

虽然 Demo 已经功能完备，但我们仍有星辰大海：

1.  **视觉表现升级**:
    *   引入 Live2D 或 Spine 骨骼动画，让角色立绘动起来。
    *   战斗特效 VFX 升级（目前主要靠文字描述和简单震动）。
2.  **更复杂的策略维度**:
    *   引入“战技点 (SP)”资源循环，限制强力技能的释放频率。
    *   引入“弱点/护盾击破”机制（Break System）。
3.  **持久化运营**:
    *   接入后端数据库（Supabase/Firebase），保存玩家生成的角色和战斗记录。
    *   排行榜系统：统计 Boss 战的通关回合数 (AV)。
4.  **多模态输入**:
    *   浏览器端语音转文字 (STT)，让玩家真的可以直接“喊”出指令。

---

## 7. 结语

**Project Soul Link** 证明了 AI Native Game 不仅仅是噱头。

我们在短短一天内，从零构建了一个包含**自建角色、即时语音、深度策略、完整叙事**的二次元 RPG 原型。这在传统开发模式下是不可想象的。

AI 没有取代游戏设计的灵魂，它成为了灵魂的扩音器。

**在这里，每一场战斗，都是属于你和 AI 伙伴的独家番剧。**
